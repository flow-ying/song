<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç§»åŠ¨ç«¯å›¾ç‰‡æ’å…¥ä¸åˆ‡æ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f5f5f5;
            overflow: hidden;
            padding: 20px;
        }
        .main-container {
            position: relative;
            width: 85vw;
            max-width: 400px;
            height: auto;
        }
        /* ğŸ”¥ ç¬¬ä¸‰å¼ å›¾ç‰‡ - åœ¨åº•å±‚ */
        .bottom-img {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: auto;
            display: block;
            z-index: 3;
        }
        /* ğŸ”¥ èƒŒæ™¯å›¾ - ä¸­å±‚ */
        .main-img {
            position: relative;
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 2;
        }
        
        /* ğŸœ ä¸­å¤®ç¢—å›¾ç‰‡ - å˜å¤§å¹¶ä¸‹ç§» */
        .center-bowl {
            position: absolute;
            top: 54%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: auto;
            z-index: 5;
            pointer-events: none;
        }
        
        /* ğŸ¥„ å‹ºå­ - æ ¹æ®ç¢—çš„ä½ç½®è°ƒæ•´ */
        .spoon {
            position: absolute;
            top: 35%;
            left: 70%;
            transform: translate(-50%, -50%) rotate(5deg);
            width: 45%;
            height: auto;
            z-index: 6;
            transition: none;
        }
        
        /* ğŸ‘† é¼ æ ‡æ‰‹å›¾æ ‡ - æ ¹æ®å‹ºå­ä½ç½®è°ƒæ•´ */
        .hand-icon {
            position: absolute;
            top: 45%;
            left: 70%;
            transform: translate(-50%, -50%);
            width: 13%;
            height: auto;
            z-index: 7;
            cursor: grab;
            display: none;
        }
        
        .hand-icon.active {
            cursor: grabbing;
        }
        
        .hand-icon.show {
            display: block;
        }
        
        /* ğŸ“ æ‹–åŠ¨æç¤ºæ–‡å­— - æ ¹æ®æ‰‹çš„ä½ç½®è°ƒæ•´ */
        .drag-tip {
            position: absolute;
            top: 52%;
            left: 73%;
            transform: translate(-50%, -50%);
            font-family: 'æ–¹æ­£æ¥·ä½“', 'FZKai-Z03S', 'KaiTi', 'æ¥·ä½“', serif;
            font-size: 3.25%; /* ç›¸å¯¹äºå®¹å™¨å®½åº¦ */
            color: #333;
            z-index: 7;
            white-space: nowrap;
            display: none;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.9);
            font-weight: 500;
        }
        
        .drag-tip.show {
            display: block;
        }
        
        /* ğŸ“Š è¿›åº¦æ˜¾ç¤º - åœ¨ç¢—ä¸Šæ–¹ */
        .progress-text {
            position: absolute;
            top: 32%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'æ–¹æ­£æ¥·ä½“', 'FZKai-Z03S', 'KaiTi', 'æ¥·ä½“', serif;
            font-size: 4.5%; /* ç›¸å¯¹äºå®¹å™¨å®½åº¦ */
            color: #8B4513;
            z-index: 7;
            font-weight: bold;
            display: none;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
        }
        
        .progress-text.show {
            display: block;
        }
        
        /* ğŸ¨ å®Œæˆåçš„å›¾ç‰‡ - ä¸ç¢—åŒæ ·å¤§å°å’Œä½ç½® */
        .finished-img {
            position: absolute;
            top: 54%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: auto;
            z-index: 8;
            display: none;
        }
        
        .finished-img.show {
            display: block;
        }
        
        /* ğŸ”¥ å¯åˆ‡æ¢çš„å›¾æ ‡ - ç¼©å°å°ºå¯¸ */
        .switchable-icon1, .switchable-icon2, .switchable-icon3 {
            position: absolute;
            bottom: 1.5%;
            width: 25%;
            aspect-ratio: 1/1;
            cursor: pointer;
            z-index: 4;
            transition: transform 0.2s ease;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
        
        .switchable-icon1 {
            left: 5%;
            background-image: url('ç‰©å“æ /2.png');
        }
        
        .switchable-icon2 {
            left: 38.5%;
            background-image: url('ç‰©å“æ /4.png');
        }
        .switchable-icon3 {
            left: 72.5%;
            background-image: url('ç‰©å“æ /3.png');
        }
            
        
        
        .switchable-icon1:active,
        .switchable-icon2:active,
        .switchable-icon3:active {
            transform: scale(0.95);
        }
        
        .insert-icon {
            position: absolute;
            width: 15%;
            height: auto;
            cursor: pointer;
            z-index: 10;
            transition: transform 0.2s ease;
        }
        .insert-icon:active {
            transform: scale(0.9);
        }
        .icon-top-right {
            top: 2%;
            right: 2%;
        }
        .icon-top-left {
            top: 2%;
            left: 2%;
        }
        
       /* å°å±å¹•ä¼˜åŒ– */
        @media screen and (max-width: 375px) {
            .main-container {
                width: 90vw;
            }
            .insert-icon {
                width: 16%;
            }
            .icon-top-right {
                top: 2%;
                right: 2%;
            }
            .icon-top-left {
                top: 2%;
                left: 2%;
            }
            .center-bowl {
                width: 110%;
            }
            .finished-img {
                width: 110%;
            }
            .drag-tip {
                font-size: 2.75%;
            }
            .progress-text {
                font-size: 4%;
                top: 33%;
            }
            .switchable-icon1, .switchable-icon2, .switchable-icon3 {
                width: 23%;
            }
            .switchable-icon1 {
                left: 6%;
            }
            .switchable-icon2 {
                left: 39.5%;
            }
            .switchable-icon3 {
                left: 73.5%;
            }
        }
        
        /* å¤§å±å¹•ä¼˜åŒ– */
        @media screen and (min-width: 768px) {
            .main-container {
                max-width: 350px;
            }
            .insert-icon {
                width: 14%;
            }
            .icon-top-right {
                top: 2%;
                right: 2%;
            }
            .icon-top-left {
                top: 2%;
                left: 2%;
            }
            .center-bowl {
                width: 90%;
            }
            .finished-img {
                width: 90%;
            }
            .drag-tip {
                font-size: 3.75%;
            }
            .progress-text {
                font-size: 5%;
                top: 34%;
            }
            .switchable-icon1, .switchable-icon2, .switchable-icon3 {
                width: 24%;
            }
            .switchable-icon1 {
                left: 4.8%;
            }
            .switchable-icon2 {
                left: 37.5%;
            }
            .switchable-icon3 {
                left: 71.5%;
            }
        }
    </style>
</head>
<body>
    <!-- èƒŒæ™¯éŸ³ä¹ -->
    <audio id="bg-music" loop preload="auto">
        <source src="../music.mp3" type="audio/mpeg">
    </audio>

    <div class="main-container">
        <!-- ğŸ”¥ ç¬¬ä¸‰å¼ å›¾ç‰‡ï¼ˆåº•å±‚ï¼‰ -->
        <img src="ç‰©å“æ /1.png" alt="åº•éƒ¨æ¡†æ¶" class="bottom-img">
        
        <!-- ğŸ”¥ èƒŒæ™¯å›¾ï¼ˆä¸­å±‚ï¼‰ -->
        <img src="èƒŒæ™¯.png" alt="ä¸»å›¾" class="main-img">
        
        <!-- ğŸœ ä¸­å¤®ç¢—å›¾ç‰‡ -->
        <img src="3.gif" alt="ç¢—" class="center-bowl" id="bowlImg">
        
        <!-- ğŸ¥„ å‹ºå­ -->
        <img src="4.png" alt="å‹ºå­" class="spoon" id="spoon">
        
        <!-- ğŸ‘† é¼ æ ‡æ‰‹å›¾æ ‡ -->
        <img src="5.png" alt="æ‹–åŠ¨æ‰‹åŠ¿" class="hand-icon" id="handIcon">
        
        <!-- ğŸ“ æ‹–åŠ¨æç¤ºæ–‡å­— -->
        <div class="drag-tip" id="dragTip">æ‹–åŠ¨ç»˜åˆ¶</div>
        
        <!-- ğŸ“Š è¿›åº¦æ˜¾ç¤º -->
        <div class="progress-text" id="progressText">0%</div>
        
        <!-- ğŸ¨ å®Œæˆåçš„å›¾ç‰‡ -->
        <img src="3.1.gif" alt="å®Œæˆä½œå“" class="finished-img" id="finishedImg">
        
        <!-- ğŸ”¥ å¯åˆ‡æ¢çš„å›¾æ ‡ -->
        <div class="switchable-icon1" id="bottomSwitchIcon1"></div>
        <div class="switchable-icon2" id="bottomSwitchIcon2"></div>
        <div class="switchable-icon3" id="bottomSwitchIcon3"></div>
        
        <!-- åŸæœ‰çš„å³ä¸Šè§’æŒ‰é’® -->
        <img src="æŒ‰é”®/3.png" alt="å³ä¸Šè§’å›¾æ ‡" class="insert-icon icon-top-right">
        
        <!-- åŸæœ‰çš„å·¦ä¸Šè§’æŒ‰é’® -->
        <img src="æŒ‰é”®/1.png" alt="å·¦ä¸Šè§’å›¾æ ‡" class="insert-icon icon-top-left" id="switchIcon">
    </div>
    
    <script>
        // è·å–éŸ³é¢‘å…ƒç´ 
        const bgMusic = document.getElementById('bg-music');
        const switchIcon = document.getElementById('switchIcon');
        const iconPaths = ["æŒ‰é”®/1.png", "æŒ‰é”®/2.png"];

        // é¡µé¢åŠ è½½æ—¶æ¢å¤éŸ³ä¹çŠ¶æ€
        window.addEventListener('load', function() {
            const savedMusicState = localStorage.getItem('musicPlaying');
            const savedMusicTime = localStorage.getItem('musicCurrentTime');

            if (savedMusicState === 'true') {
                switchIcon.src = iconPaths[0]; // æ˜¾ç¤ºæ’­æ”¾å›¾æ ‡
                // å»¶è¿Ÿæ’­æ”¾ä»¥ç¡®ä¿éŸ³é¢‘å…ƒç´ å·²å‡†å¤‡å¥½
                setTimeout(() => {
                    if (savedMusicTime) {
                        const time = parseFloat(savedMusicTime);
                        if (!isNaN(time) && time >= 0) {
                            bgMusic.currentTime = time;
                        }
                    }
                    bgMusic.play().catch(function(error) {
                        console.log('Audio play failed:', error);
                    });
                }, 100);
            } else {
                switchIcon.src = iconPaths[1]; // æ˜¾ç¤ºæš‚åœå›¾æ ‡
            }
        });

        // éŸ³ä¹æŒ‰é’®åˆ‡æ¢åŠŸèƒ½
        let currentIconIndex = 0;
        switchIcon.addEventListener('click', function() {
            const isPlaying = !bgMusic.paused;

            if (isPlaying) {
                // å½“å‰æ­£åœ¨æ’­æ”¾ï¼Œæš‚åœéŸ³ä¹
                bgMusic.pause();
                switchIcon.src = iconPaths[1]; // æ˜¾ç¤ºæš‚åœå›¾æ ‡
                localStorage.setItem('musicPlaying', 'false');
                currentIconIndex = 1;
            } else {
                // å½“å‰æš‚åœï¼Œæ’­æ”¾éŸ³ä¹
                bgMusic.play().catch(function(error) {
                    console.log('Audio play failed:', error);
                });
                switchIcon.src = iconPaths[0]; // æ˜¾ç¤ºæ’­æ”¾å›¾æ ‡
                localStorage.setItem('musicPlaying', 'true');
                currentIconIndex = 0;
            }
        });
        
        // ğŸ”¥ åº•éƒ¨ç¬¬ä¸€ä¸ªå›¾æ ‡åˆ‡æ¢åŠŸèƒ½ï¼ˆæ¿€æ´»æ‹–åŠ¨æ¨¡å¼ï¼‰
        const bottomSwitchIcon1 = document.getElementById('bottomSwitchIcon1');
        const bottomIconPaths1 = ["ç‰©å“æ /2.png", "ç‰©å“æ /2.1.png"];
        let currentBottomIndex1 = 0;
        let dragMode = false;
        
        bottomSwitchIcon1.addEventListener('click', function() {
            currentBottomIndex1 = 1 - currentBottomIndex1;
            bottomSwitchIcon1.style.backgroundImage = `url('${bottomIconPaths1[currentBottomIndex1]}')`;
            
            // åˆ‡æ¢åˆ°ç¬¬äºŒå¼ å›¾ç‰‡æ—¶æ¿€æ´»æ‹–åŠ¨æ¨¡å¼
            if (currentBottomIndex1 === 1) {
                dragMode = true;
                handIcon.classList.add('show');
                dragTip.classList.add('show');
                progressText.classList.add('show');
                progressText.textContent = '0%';
                // é‡ç½®æ‹–åŠ¨è·ç¦»
                dragDistance = 0;
            } else {
                dragMode = false;
                handIcon.classList.remove('show');
                dragTip.classList.remove('show');
                progressText.classList.remove('show');
            }
        });
        
        // ğŸ”¥ åº•éƒ¨ç¬¬äºŒä¸ªå›¾æ ‡åˆ‡æ¢åŠŸèƒ½
        const bottomSwitchIcon2 = document.getElementById('bottomSwitchIcon2');
        const bottomIconPaths2 = ["ç‰©å“æ /4.png", "ç‰©å“æ /4.1.png"];
        let currentBottomIndex2 = 0;
        bottomSwitchIcon2.addEventListener('click', function() {
            currentBottomIndex2 = 1 - currentBottomIndex2;
            bottomSwitchIcon2.style.backgroundImage = `url('${bottomIconPaths2[currentBottomIndex2]}')`;
        });
        
        // ğŸ”¥ åº•éƒ¨ç¬¬ä¸‰ä¸ªå›¾æ ‡åˆ‡æ¢åŠŸèƒ½
        const bottomSwitchIcon3 = document.getElementById('bottomSwitchIcon3');
        const bottomIconPaths3 = ["ç‰©å“æ /3.png", "ç‰©å“æ /3.1.png"];
        let currentBottomIndex3 = 0;
        bottomSwitchIcon3.addEventListener('click', function() {
            currentBottomIndex3 = 1 - currentBottomIndex3;
            bottomSwitchIcon3.style.backgroundImage = `url('${bottomIconPaths3[currentBottomIndex3]}')`;
        });
        
        // ğŸ¨ æ‹–åŠ¨ç»˜åˆ¶åŠŸèƒ½
        const handIcon = document.getElementById('handIcon');
        const spoon = document.getElementById('spoon');
        const bowlImg = document.getElementById('bowlImg');
        const finishedImg = document.getElementById('finishedImg');
        const dragTip = document.getElementById('dragTip');
        const progressText = document.getElementById('progressText');
        const mainContainer = document.querySelector('.main-container');
        
        let isDragging = false;
        let startX, startY;
        let currentX, currentY;
        let dragDistance = 0;
        const requiredDistance = 150; // æ‹–åŠ¨è·ç¦»è®¾ç½®ä¸º150åƒç´ 
        
        // è·å–ç¢—çš„è¾¹ç•Œ
        function getBowlBounds() {
            const bowlRect = bowlImg.getBoundingClientRect();
            const containerRect = mainContainer.getBoundingClientRect();
            
            return {
                left: bowlRect.left - containerRect.left,
                right: bowlRect.right - containerRect.left,
                top: bowlRect.top - containerRect.top,
                bottom: bowlRect.bottom - containerRect.top,
                centerX: (bowlRect.left + bowlRect.right) / 2 - containerRect.left,
                centerY: (bowlRect.top + bowlRect.bottom) / 2 - containerRect.top,
                width: bowlRect.width,
                height: bowlRect.height
            };
        }
        
        // æ£€æŸ¥ä½ç½®æ˜¯å¦åœ¨ç¢—å†…
        function isInsideBowl(x, y) {
            const bounds = getBowlBounds();
            const radius = bounds.width / 2;
            const dx = x - bounds.centerX;
            const dy = y - bounds.centerY;
            const distance = Math.sqrt(dx * dx + dy * dy);
            return distance <= radius * 0.85; // ç¨å¾®ç¼©å°èŒƒå›´ï¼Œç•™å‡ºè¾¹è·
        }
        
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const progress = Math.min(100, Math.floor((dragDistance / requiredDistance) * 100));
            progressText.textContent = progress + '%';
        }
        
        // é¼ æ ‡/è§¦æ‘¸å¼€å§‹
        function handleStart(e) {
            if (!dragMode) return;
            
            e.preventDefault();
            isDragging = true;
            
            const point = e.touches ? e.touches[0] : e;
            startX = point.clientX;
            startY = point.clientY;
            currentX = startX;
            currentY = startY;
            
            handIcon.classList.add('active');
        }
        
        // é¼ æ ‡/è§¦æ‘¸ç§»åŠ¨
        function handleMove(e) {
            if (!isDragging || !dragMode) return;
            
            e.preventDefault();
            const point = e.touches ? e.touches[0] : e;
            currentX = point.clientX;
            currentY = point.clientY;
            
            const containerRect = mainContainer.getBoundingClientRect();
            const relativeX = currentX - containerRect.left;
            const relativeY = currentY - containerRect.top;
            
            // æ£€æŸ¥æ˜¯å¦åœ¨ç¢—å†…
            if (isInsideBowl(relativeX, relativeY)) {
                // æ›´æ–°æ‰‹çš„ä½ç½®
                const percentX = (relativeX / containerRect.width) * 100;
                const percentY = (relativeY / containerRect.height) * 100;
                
                handIcon.style.left = percentX + '%';
                handIcon.style.top = percentY + '%';
                
                dragTip.style.left = percentX + '%';
                dragTip.style.top = (percentY + 6) + '%';
                
                // å‹ºå­è·Ÿéšç§»åŠ¨
                spoon.style.left = percentX + '%';
                spoon.style.top = percentY + '%';
                
                // è®¡ç®—æ‹–åŠ¨è·ç¦»
                const dx = currentX - startX;
                const dy = currentY - startY;
                dragDistance += Math.sqrt(dx * dx + dy * dy);
                startX = currentX;
                startY = currentY;
                
                // æ›´æ–°è¿›åº¦
                updateProgress();
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆç»˜åˆ¶
                if (dragDistance >= requiredDistance) {
                    completeDrawing();
                }
            }
        }
        
        // é¼ æ ‡/è§¦æ‘¸ç»“æŸ
        function handleEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            handIcon.classList.remove('active');
        }
        
        // å®Œæˆç»˜åˆ¶
        function completeDrawing() {
            isDragging = false;
            dragMode = false;
            
            // éšè—æ‰‹å’Œæç¤º
            handIcon.classList.remove('show', 'active');
            dragTip.classList.remove('show');
            progressText.classList.remove('show');
            
            // éšè—ç¢—å’Œå‹ºå­
            bowlImg.style.display = 'none';
            spoon.style.display = 'none';
            
            // æ˜¾ç¤ºå®Œæˆå›¾ç‰‡
            finishedImg.classList.add('show');

            // é‡ç½®ç¬¬ä¸€ä¸ªå›¾æ ‡
            currentBottomIndex1 = 0;
            bottomSwitchIcon1.style.backgroundImage = `url('${bottomIconPaths1[0]}')`;

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ - å½“å®Œæˆå›¾ç‰‡æ˜¾ç¤ºåï¼Œç‚¹å‡»è·³è½¬åˆ° sf1.html
            document.addEventListener('click', function jumpToSf1() {
                // æ£€æŸ¥å®Œæˆå›¾ç‰‡æ˜¯å¦å¯è§
                if (finishedImg.classList.contains('show')) {
                    // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨é˜²æ­¢é‡å¤ç‚¹å‡»
                    document.removeEventListener('click', jumpToSf1);

                    // åˆ›å»ºè·³è½¬åŠ¨ç”»ï¼ˆå¦‚æœéœ€è¦çš„è¯ï¼‰
                    const transitionDiv = document.createElement('div');
                    transitionDiv.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background-color: rgba(0, 0, 0, 0.8);
                        z-index: 9999;
                        opacity: 0;
                        transition: opacity 1.5s ease-out;
                    `;
                    document.body.appendChild(transitionDiv);

                    // è§¦å‘åŠ¨ç”»
                    requestAnimationFrame(() => {
                        transitionDiv.style.opacity = '1';
                    });

                    // 1.5ç§’åè·³è½¬
                    setTimeout(function() {
                        // åœ¨è·³è½¬å‰ä¿å­˜å½“å‰éŸ³ä¹çŠ¶æ€
                        const bgMusic = document.getElementById('bg-music');
                        const isPlaying = !bgMusic.paused;
                        localStorage.setItem('musicPlaying', isPlaying ? 'true' : 'false');
                        localStorage.setItem('musicCurrentTime', bgMusic.currentTime.toFixed(3));

                        window.location.href = '../åˆ†äº«é¡µ/sf1.html';
                    }, 1500);
                }
            });
            
            // é‡ç½®æ‹–åŠ¨è·ç¦»
            dragDistance = 0;
        }
        
        // ç»‘å®šäº‹ä»¶ï¼ˆæ”¯æŒé¼ æ ‡å’Œè§¦æ‘¸ï¼‰
        handIcon.addEventListener('mousedown', handleStart);
        handIcon.addEventListener('touchstart', handleStart, { passive: false });
        
        document.addEventListener('mousemove', handleMove);
        document.addEventListener('touchmove', handleMove, { passive: false });
        
        document.addEventListener('mouseup', handleEnd);
        document.addEventListener('touchend', handleEnd);
    </script>
</body>
</html>